# Решение предупреждения Dexie SchemaDiff

## Предупреждение

```
Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.
```

## Причина

Это предупреждение появляется, когда:
1. База данных в браузере была создана с более старой версией схемы
2. Код пытается использовать новую схему (версия 4) с полями `is_final` и таблицей `syncRegistry`
3. Dexie обнаруживает несоответствие между существующей БД и новой схемой

## Решение

### Вариант 1: Очистить IndexedDB (рекомендуется для разработки)

1. Откройте DevTools (F12)
2. Application → IndexedDB → WbAnalyticsDB
3. Нажмите правой кнопкой на базу данных → "Delete database"
4. Перезагрузите страницу

База данных будет создана заново с актуальной схемой версии 4.

### Вариант 2: Дождаться автоматической миграции

Dexie автоматически выполнит миграцию при следующем открытии базы данных. Предупреждение может появиться один раз, после миграции оно исчезнет.

### Вариант 3: Проверить версию базы данных

В консоли браузера:

```javascript
// Проверить текущую версию БД
db.version

// Проверить схему
db.tables.forEach(table => {
  console.log(table.name, table.schema)
})
```

Ожидаемая версия: **4**

## Важно

- Это **предупреждение**, а не ошибка
- Приложение должно работать корректно после миграции
- Если предупреждение не исчезает, используйте Вариант 1 (очистить БД)

## Проверка после исправления

После очистки БД или миграции проверьте:

```javascript
SyncDebug.checkDatabaseStructure()
```

Должно показать:
- ✓ Таблица syncRegistry создана
- ✓ Поле is_final присутствует в sales и returns
